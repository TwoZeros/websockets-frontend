<!doctype html>
<html lang="ru">

<head>
  <!-- Обязательные метатеги -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <title>test</title>
</head>

<body>


<div class="container py-5">
  <!-- logo -->
  <div class="header-left header-left-one">
    <a href="index.html" class="logo">
      <img src="logo.svg" width="120" height="120" alt="Logo">
    </a>
  </div>
  <!-- logo -->


  <!-- add user  -->
  <div class="col-md-7 col-lg-8">
    <h4 class="mb-3">Add User</h4>
      <div class="row g-3">
        <div class="col-sm-3">
          <label for="firstName" class="form-label">login</label>
          <input type="text" class="form-control" id="new-user-login" placeholder="login" value="" required="" new-user-login="">
          <div class="invalid-feedback">
            login ?
          </div>
        </div>

        <div class="col-sm-3">
          <label for="lastName" class="form-label">password</label>
          <input type="password" id="new-user-password" class="form-control" placeholder="password" value="" required="" new-user-password="">
          <div class="invalid-feedback">
            pass ?
          </div>
        </div>
      </div>
      <div class="row g-3 py-3">
        <div class="col-sm-3">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-add-new-user="">add user</button>
        </div>
      </div>        
  </div>
  <hr>
  <!-- end add user  -->


  <!-- auth user  -->
  <div class="col-md-7 col-lg-8">
    <h4 class="mb-3">Auth User</h4>
      <div class="row g-3">
        <div class="col-sm-3">
          <label for="firstName" class="form-label">login</label>
          <input type="text" class="form-control" id="auth-user-login" placeholder="login" value="" required=""
            auth-user-login="">
          <div class="invalid-feedback">
            login ?
          </div>
        </div>
  
        <div class="col-sm-3">
          <label for="lastName" class="form-label">password</label>
          <input type="password" id="auth-user-password" class="form-control" placeholder="password" required=""
            auth-user-password="">
          <div class="invalid-feedback">
            pass ?
          </div>
        </div>
      </div>
      <div class="row g-3 py-3">
        <div class="col-sm-3">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-auth-user="">auth user</button>
        </div>
      </div>
  </div>
  <hr>
  <!-- end auth user  -->


  <!-- change user password  -->
  <div class="col-md-7 col-lg-8">
    <h4 class="mb-3">Change user password</h4>
      <div class="row g-3">
        <div class="row g-3 py-3">
          <div class="col-sm-2">
            <label for="firstName" class="form-label">user id</label>
            <input type="text" class="form-control" id="user-id" placeholder="id" value="" required=""
              user-id="">
            <div class="invalid-feedback">
              id ?
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <label for="firstName" class="form-label">old password</label>
          <input type="password" class="form-control" id="old-user-password" placeholder="old password" value="" required=""
            old-user-password="">
          <div class="invalid-feedback">
            old password ?
          </div>
        </div>
  
        <div class="col-sm-3">
          <label for="lastName" class="form-label">new password</label>
          <input type="password" id="new-user-password" class="form-control" placeholder="new password" required=""
            new-user-password-change="">
          <div class="invalid-feedback">
            new password ?
          </div>
        </div>
      </div>
      <div class="row g-3 py-3">
        <div class="col-sm-3">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-change-user-password="">change user password</button>
        </div>
      </div>
  </div>
  <hr>
  <!-- end change user password  -->


  <!-- get user list -->
  <div class="row g-3">
    <div class="col-md-7 col-lg-8">
      <h4 class="mb-3">Get user list</h4>
      <div class="row g-3 py-3">
        <div class="col-sm-3">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-user-list="">get user list</button>
        </div>
      </div>
    </div>

    <div class="col-md-5 col-lg-4 order-md-last">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Result user list</span>
        <span class="badge bg-secondary rounded-pill" all-users=""></span>
      </h4>
      <ul class="list-group mb-3" result-user-list=""></ul>
    </div>
  </div>
  <hr>
  <!-- end get user list -->


  <!-- change user status  -->
  <div class="col-md-7 col-lg-8">
    <h4 class="mb-3">Change user status</h4>
    <div class="row g-3">
      <div class="row g-3 py-3">
        <div class="col-sm-2">
          <label for="firstName" class="form-label">user id</label>
          <input type="text" class="form-control" id="change-user-status-id" placeholder="id" value="" required="" change-user-status-id="">
        </div>
      </div>

    </div>
    <div class="row g-3 py-3">
      <div class="col-sm-3">
        <button class="btn btn-primary btn-sm btn-block" type="submit" btn-change-user-status="">change user status</button>
      </div>
    </div>
  </div>
  <hr>
  <!-- end change user status  -->


  <!-- get numbers-->
  <div class="row g-3">
    <div class="col-md-7 col-lg-8">
      <h4 class="mb-3">Start / Stop</h4>
      <div class="row g-1 py-3">
        <div class="col-sm-1">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-start="">start</button>
        </div>
        <div class="col-sm-1">
          <button class="btn btn-primary btn-sm btn-block" type="submit" btn-stop="">stop</button>
        </div>
      </div>
    </div>
  
    <div class="col-md-5 col-lg-4 order-md-last">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Result start / stop</span>
        <span class="badge bg-secondary rounded-pill" ></span>
      </h4>
      
      <div class="list-group mb-3" result-job=""></div>
    </div>
  </div>
  <hr>
  <!-- end get numbers-->

</div>



  <!-- Необязательный JavaScript; выберите один из двух! -->

  <!-- Вариант 1: пакет Bootstrap с Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>
  <!-- jQuery -->
  <script src="./jquery/jquery.min.js"></script>
  
  <!-- Вариант 2: отдельные JS для Popper и Bootstrap -->
  <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
    -->


  <script>

    let ws = new WebSocket(`ws://localhost:8080/api/test`);

    ws.onopen = (ev) => {
      console.log("connect - ok");
    };

    ws.onmessage = function (ev) {
      let obj = jQuery.parseJSON(ev.data);

      switch (obj.operation) {
      
        case ("auth"): {
          showResultAuth(obj);
          break;
        }

        case ("add_user"): {
          showResultAddUser(obj);
          break;
        }

        case ("edit_user_password"): {
          showResultChangePass(obj);
          break;
        }

        case ("get_user_list"): {
          showUserList(obj);
          break;
        }

        case ("new_result"): {
          showResultJob(obj);
          break;
        }

        case ("change_user_status"): {
          showResultChangeUserStatus(obj);
          break;
        }
      }
    }

    // add user
    $("body").on("click", "[btn-add-new-user]", () => {
      if ($("[new-user-login]").val().length && $("[new-user-password]").val().length) {
        let mgs = {};
        mgs["operation"] = "add_user";
        mgs["login"] = $("[new-user-login]").val();
        mgs["password"] = $("[new-user-password]").val();
        ws.send(JSON.stringify(mgs));

        $("[new-user-login]").val("");
        $("[new-user-password]").val("");

        getUserList();

      } else alert("Enter login and password!");
    });

    
    $("body").on("click", "[btn-auth-user]", () => {
      if ($("[auth-user-login]").val().length && $("[auth-user-password]").val().length) {
        let mgs = {};
        mgs["operation"] = "auth";
        mgs["login"] = $("[auth-user-login]").val();
        mgs["password"] = $("[auth-user-password]").val();
        ws.send(JSON.stringify(mgs));

        $("[auth-user-login]").val("");
        $("[auth-user-password]").val("");
      } else alert("Enter login and password!");
    });


    $("body").on("click", "[btn-change-user-password]", () => {
      let mgs = {};
      mgs["operation"] = "edit_user_password";
      mgs["user_id"] = $("[user-id]").val();
      mgs["old_password"] = $("[old-user-password]").val();
      mgs["new_password"] = $("[new-user-password-change]").val();
      ws.send(JSON.stringify(mgs));

      $("[user-id]").val("");
      $("[old-user-password]").val("");
      $("[new-user-password-change").val("");
    });

    
    $("body").on("click", "[btn-user-list]", () => {
      getUserList();
    });


    let getUserList = () => {
        let mgs = {};
        mgs["operation"] = "get_user_list";
        ws.send(JSON.stringify(mgs));
    };


    $("body").on("click", "[btn-change-user-status]", () => {
      let mgs = {};
      mgs["user_id"] = $("[change-user-status-id]").val();
      mgs["operation"] = "change_user_status";
      ws.send(JSON.stringify(mgs));

      $("[change-user-status-id]").val("");
    });

    
    $("body").on("click", "[btn-start]", () => {
      let mgs = {};
      mgs["operation"] = "start_job";
      ws.send(JSON.stringify(mgs));
    });


    $("body").on("click", "[btn-stop]", () => {
      let mgs = {};
      mgs["operation"] = "stop_job";
      ws.send(JSON.stringify(mgs));

      $("[result-job]").html("");
    });


    let showResultAuth = (obj) => {
      console.log("showResultAuth", obj.status);
      (obj.status == true) 
        ? alert("Пользователь авторизовался успешно!")
        : alert("Неверный логин или пароль!");
    };


    let showResultAddUser = (obj) => {
      (obj.status == true)
        ? alert("Пользователь добавлен!")
        : alert("Пользователь не добавлен!");
    };


    let showResultChangePass = (obj) => {
      (obj.status == true)
        ? alert("Пароль изменен!")
        : alert("Пароль не изменен!");
    };


    let showUserList = (obj) => {
      $("[result-user-list]").html("");
      let users = obj.data;

      users.map(user => {
        $("[result-user-list]").append(`
          <li class="list-group-item d-flex justify-content-between lh-sm">
            <div>
              <h6 class="my-0">Id: ${user.user_id}</h6>
            </div>
            <div>
              <h6 class="my-0">Login: ${user.login}</h6>
            </div>
            <div>
              <h6 class="my-0">Date: ${user.last_auth}</h6>
            </div>
            <div>
              <h6 class="my-0">Status: ${user.status}</h6>
            </div>
          </li>
        `);
      }); 
    }


    let showResultChangeUserStatus = (obj) => {
      (obj.status == true)
        ? alert("Статус изменен!")
        : alert("Статус не изменен!");
    };


    let showResultJob = (obj) => {
      $("[result-job]").html("");
      let data = obj.data;

      $("[result-job]").html(`
        <h6 class="my-0">${data}</h6>
      `);
    }

  </script>   
</body>

</html>